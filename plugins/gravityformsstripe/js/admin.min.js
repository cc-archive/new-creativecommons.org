window.GFStripeAdmin=null,function(r){function t(){var c=this;this.accountSettingsLocked=!1,this.deauthActionable=!1,this.apiMode=r('[name="_gaddon_setting_api_mode"]:checked').val(),this.init=function(){this.initKeyStatus("live_publishable_key"),this.initKeyStatus("live_secret_key"),this.initKeyStatus("test_publishable_key"),this.initKeyStatus("test_secret_key"),this.bindDeauthorize(),this.bindAPIModeChange(),this.maybeLockAccountSettings(),this.bindWebhookAlert()},this.validateKey=function(t,e){0!=e.length?(r("#"+t).val(e.trim()),this.setKeyStatusIcon(t,"<img src='"+gforms_stripe_admin_strings.spinner+"'/>"),"live_publishable_key"==t||"test_publishable_key"==t?this.validatePublishableKey(t,e):this.validateSecretKey(t,e)):this.setKeyStatus(t,"")},this.validateSecretKey=function(e,t){r.post(ajaxurl,{action:"gf_validate_secret_key",keyName:e,key:t,nonce:gforms_stripe_admin_strings.ajax_nonce},function(t){"valid"==(t=t.trim())?c.setKeyStatus(e,"1"):"invalid"==t?c.setKeyStatus(e,"0"):c.setKeyStatusIcon(e,gforms_stripe_admin_strings.validation_error)})},this.validatePublishableKey=function(i,t){this.setKeyStatusIcon(i,"<img src='"+gforms_stripe_admin_strings.spinner+"'/>"),cc={number:"4916433572511762",exp_month:"01",exp_year:(new Date).getFullYear()+1,cvc:"111",name:"Test Card"},Stripe.setPublishableKey(t),Stripe.card.createToken(cc,function(t,e){200!=t&&(400!=t&&402!=t||"live_publishable_key"!=i)?c.setKeyStatus(i,"0"):c.setKeyStatus(i,"1")})},this.initKeyStatus=function(t){var e=r("#"+t+"_is_valid"),i=r("#"+t);0<e.length?this.setKeyStatus(t,e.val()):0<i.length&&this.validateKey(t,i.val())},this.setKeyStatus=function(t,e){r("#"+t+"_is_valid").val(e);var i="";"1"==e?i='<i class="fa icon-check fa-check gf_valid"></i>':"0"==e&&(i='<i class="fa icon-remove fa-times gf_invalid"></i>'),this.setKeyStatusIcon(t,i)},this.setKeyStatusIcon=function(t,e){var i=r("#"+t+"_status_icon");0<i.length&&i.remove(),r("#"+t).after("<span id='"+t+"_status_icon'>&nbsp;&nbsp;"+e+"</span>")},this.bindDeauthorize=function(){r(".gform_stripe_deauth_button").on("click",function(t){if(t.preventDefault(),c.accountSettingsLocked)return window.location.reload(),!1;var e=r(".gform_stripe_deauth_button"),i=r(".deauth_scope"),n=gforms_stripe_admin_strings.disconnect,s=r(this).data("mode"),a=r(this).data("fid");if(c.deauthActionable){var o=r("#"+s+"_deauth_scope0").is(":checked")?"site":"account",d="site"==o&&""!==a?n.feed:n[o];if(!confirm(d))return!1;e.attr("disabled","disabled"),r.ajax({async:!1,url:ajaxurl,dataType:"json",method:"POST",data:{action:"gfstripe_deauthorize",scope:o,fid:a,id:r(this).data("id"),mode:s,nonce:gforms_stripe_admin_strings.ajax_nonce},success:function(t){t.success?window.location.reload():alert(t.data.message),$button.removeAttr("disabled")}})}else e.eq(0).hide(),""!==a&&r(".connected_to_stripe_text").hide(),i.show("slow",function(){c.deauthActionable=!0})})},this.bindAPIModeChange=function(){""!==this.apiMode&&void 0!==this.apiMode||(this.apiMode="live",r("#api_mode0").prop("checked",!0));var e="live"===this.apiMode?"test":"live";r("#gaddon-setting-row-"+this.apiMode+"_auth_token").show(),r("#gaddon-setting-row-"+e+"_auth_token").hide(),r('#tab_gravityformsstripe input[name="_gaddon_setting_api_mode"]').on("click",function(t){c.apiMode=r(this).val(),e="live"===c.apiMode?"test":"live",r("#gaddon-setting-row-"+e+"_auth_token").hide(),r("#gaddon-setting-row-"+c.apiMode+"_auth_token").show()})},this.maybeLockAccountSettings=function(){var t=r("#gaddon-setting-row-connected_to").siblings("#gaddon-setting-row-api_mode, #gaddon-setting-row-live_auth_token, #gaddon-setting-row-test_auth_token");t.hide(),r("#gform_stripe_change_account").on("click",function(){r(this).data("disabled")?alert(gforms_stripe_admin_strings.switch_account_disabled_message):(t.show("slow"),c.bindAPIModeChange(),r(this).off("click").addClass("disabled"))}),r("table.gforms_form_settings").on("change","input, select",function(){var t=r(this).attr("name");"_gaddon_setting_api_mode"!==t&&"deauth_scope"!==t&&"_gaddon_setting_transactionType"!==t&&(c.accountSettingsLocked=!0)}),r("#gform-settings-save").on("click",function(){r(".error.below-h2").remove(),c.accountSettingsLocked=!1}),window.addEventListener("beforeunload",function(t){(c.accountSettingsLocked||r(".error.below-h2").length)&&(t.preventDefault(),t.returnValue="")})},this.bindWebhookAlert=function(){r("#gform_stripe_change_account").length&&""===r("#"+this.apiMode+"_signing_secret").val()&&(r("#webhooks_enabled").focus(),r([document.documentElement,document.body]).animate({scrollTop:r("#gaddon-setting-row-api_mode").offset().top+20},1e3))},this.init()}r(document).ready(function(){GFStripeAdmin=new t})}(jQuery);